# RAG-REITsTextFlow

ä¸€ä¸ªç”¨äºREITså…¬å‘ŠPDFæ–‡æ¡£å¤„ç†é¡¹ç›®ã€‚

## é¡¹ç›®ç®€ä»‹

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºå¤„ç†åŸºç¡€è®¾æ–½å…¬å‹ŸREITsï¼ˆReal Estate Investment Trustsï¼‰å…¬å‘ŠPDFæ–‡ä»¶æ¸…æ´—çš„å®Œæ•´æ•°æ®å¤„ç†ç®¡é“ã€‚ç³»ç»Ÿèƒ½å¤Ÿè‡ªåŠ¨åŒ–åœ°å°†PDFå…¬å‘Šæ–‡æ¡£è½¬æ¢ä¸ºç»“æ„åŒ–æ•°æ®ï¼Œèƒ½å¤Ÿæ£€æµ‹è¡¨æ ¼ã€å®ç°è·¨é¡µè¡¨æ ¼æ‹¼æ¥ï¼Œå¹¶å°†è¡¨æ ¼å†…å®¹è¿˜åŸä¸ºä¾¿äºæ£€ç´¢çš„æ–‡æœ¬ä¿¡æ¯ã€‚å¹¶æ„å»ºå‘é‡æ•°æ®åº“å’Œ Elasticsearch ï¼Œå®ç°æœ¬åœ°çŸ¥è¯†åº“ï¼Œä»¥æ”¯æŒæ™ºèƒ½æ£€ç´¢ä¸é—®ç­”ç³»ç»Ÿã€‚

## ğŸš€ ä¸»è¦åŠŸèƒ½

### æ ¸å¿ƒå¤„ç†æµç¨‹

```mermaid
graph TD
    A[PDFæ–‡æ¡£è¾“å…¥] --> B[æ­¥éª¤1: PDFæ–‡æœ¬æå–]
    B --> B1[çŸ¢é‡é¡µ: æå–æ–‡æœ¬ä¿¡æ¯]
    B --> B2[æ‰«æé¡µ: è½¬æ¢ä¸ºå›¾ç‰‡]
    
    B1 --> C1[çŸ¢é‡é¡µè¡¨æ ¼æ£€æµ‹ã€è·¨é¡µè¡¨æ ¼é¡µæ‹¼æ¥<br/>pdfplumber]
    B2 --> C2[æ‰«æé¡µè¡¨æ ¼æ£€æµ‹ã€è·¨é¡µè¡¨æ ¼é¡µæ‹¼æ¥<br/>transformers+å¤šæ¨¡æ€LLM+cv2+pytesseract]
    
    C1 --> D[æ­¥éª¤3: å›¾åƒæè¿°ç”Ÿæˆ]
    C2 --> D
    D --> D1[è¡¨æ ¼é¡µ: ç”Ÿæˆè¡¨æ ¼é¡µæ–‡æœ¬ä¿¡æ¯åŠè¡¨æ ¼æè¿°<br/>ä¸¤æ¬¡å¤šæ¨¡æ€LLM + OCR]
    D --> D2[éè¡¨æ ¼é¡µ: ç”Ÿæˆæ–‡æœ¬ä¿¡æ¯<br/>å¤šæ¨¡æ€LLM + OCR]
    
    D1 --> E[æ­¥éª¤4: æ–‡æœ¬åˆå¹¶]
    D2 --> E
    E --> F[æ­¥éª¤5: æ™ºèƒ½æ–‡æœ¬åˆ‡åˆ†<br/>ä¿æŠ¤è¡¨æ ¼å®Œæ•´æ€§]
    F --> G[æ­¥éª¤6: æ–‡æœ¬å‘é‡åŒ–]
    G --> H[æ­¥éª¤7: æ•°æ®å­˜å‚¨]
    H --> I[Elasticsearch]
    H --> J[Milvuså‘é‡åº“]
    
    style A fill:#e1f5fe
    style E fill:#f0f4c3
    style H fill:#f3e5f5
    style I fill:#e8f5e8
    style J fill:#fff3e0
```

#### è¯¦ç»†æµç¨‹è¯´æ˜

1. **PDFæ–‡æœ¬æå–** - åŒºåˆ†çŸ¢é‡é¡µå’Œæ‰«æé¡µï¼ŒçŸ¢é‡é¡µç›´æ¥æå–æ–‡æœ¬ï¼Œæ‰«æé¡µè½¬ä¸ºå›¾ç‰‡å¤„ç†
2. **è¡¨æ ¼æ£€æµ‹ä¸è·¨é¡µåˆå¹¶** - çŸ¢é‡é¡µä½¿ç”¨pdfplumberï¼Œæ‰«æé¡µç»¼åˆè¿ç”¨transformersæ¨¡å‹ã€å¤šæ¨¡æ€LLMã€cv2ã€pytesseractç­‰æ™ºèƒ½æ£€æµ‹å¹¶æ‹¼æ¥è·¨é¡µè¡¨æ ¼
3. **å›¾åƒæè¿°ç”Ÿæˆ** - è¡¨æ ¼é¡µé€šè¿‡å¤šå±‚çº§LLM+OCRç”Ÿæˆè¡¨æ ¼è¯¦ç»†æè¿°åŠæ–‡æœ¬ä¿¡æ¯ï¼Œéè¡¨æ ¼é¡µä½¿ç”¨å¤šæ¨¡æ€LLM+OCRæå–æ–‡æœ¬
4. **æ–‡æœ¬åˆå¹¶** - æ™ºèƒ½åˆå¹¶å’Œæ›¿æ¢ï¼Œç”Ÿæˆå®Œæ•´æ–‡æ¡£å†…å®¹
5. **æ™ºèƒ½æ–‡æœ¬åˆ‡åˆ†** - ä¿è¯è¡¨æ ¼å†…å®¹å®Œæ•´æ€§ï¼Œé¿å…åˆ‡æ–­è¡¨æ ¼ç»“æ„
6. **æ–‡æœ¬å‘é‡åŒ–** - ç”Ÿæˆé«˜è´¨é‡æ–‡æœ¬åµŒå…¥å‘é‡
7. **æ•°æ®å­˜å‚¨** - åŒæ—¶æ”¯æŒElasticsearchå’ŒMilvuså‘é‡æ•°æ®åº“

### ğŸ”¥ æŠ€æœ¯ç‰¹æ€§

- **æ™ºèƒ½è¡¨æ ¼å¤„ç†** - ç»¼åˆè¿ç”¨transformersæ¨¡å‹ã€å¤šæ¨¡æ€LLMã€cv2ã€pytesseractç­‰æ–¹æ³•ï¼Œè‡ªåŠ¨æ£€æµ‹è¡¨æ ¼ã€è¯†åˆ«å¹¶æ‹¼æ¥è·¨é¡µè¡¨æ ¼

- **LLMå¢å¼ºæè¿°** - ç›¸è¾ƒäºä¼ ç»Ÿè¡¨æ ¼ä¿¡æ¯æå–ï¼Œé‡‡ç”¨å¤§è¯­è¨€æ¨¡å‹ç”Ÿæˆè¡¨æ ¼å†…å®¹çš„è¯­ä¹‰åŒ–æè¿°ï¼Œè®©è¡¨æ ¼æ•°æ®æ›´æ˜“äºç†è§£å’Œæ£€ç´¢

- **æ™ºèƒ½åˆ‡åˆ†ä¿æŠ¤** - æ–‡æœ¬åˆ†å‰²æ—¶æ™ºèƒ½è¯†åˆ«è¡¨æ ¼è¾¹ç•Œï¼Œç¡®ä¿è¡¨æ ¼å†…å®¹ä¸è¢«ç ´åï¼Œä¿æŒæ•°æ®å®Œæ•´æ€§

- **å¤šæ•°æ®åº“æ”¯æŒ** - åŒæ—¶æ”¯æŒElasticsearchå…¨æ–‡æ£€ç´¢å’ŒMilvuså‘é‡æ£€ç´¢ï¼Œæä¾›å¤šæ ·åŒ–çš„æŸ¥è¯¢èƒ½åŠ›

- **æ¨¡å—åŒ–è®¾è®¡** - æ¯ä¸ªæ­¥éª¤ç‹¬ç«‹è¿è¡Œï¼Œä¾¿äºè°ƒè¯•å’Œç»´æŠ¤ï¼Œæ”¯æŒçµæ´»çš„æµç¨‹å®šåˆ¶



## ğŸ“ é¡¹ç›®ç»“æ„

```
rag_v2/
â”œâ”€â”€ table-transformer-detection                    # table-transformer æ¨¡å‹
â”œâ”€â”€ README.md                                      # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ .gitignore                                     # Gitå¿½ç•¥æ–‡ä»¶é…ç½®
â”œâ”€â”€ requirements.txt                               # Pythonä¾èµ–åŒ…åˆ—è¡¨
â”‚
â”œâ”€â”€ é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ db_config.py                               # æ•°æ®åº“é…ç½®(MySQLã€Elasticsearchã€Milvus)
â”‚   â”œâ”€â”€ model_config.py                            # AIæ¨¡å‹APIé…ç½®(å„å‚å•†APIå¯†é’¥)
â”‚   â”œâ”€â”€ file_paths_config.py                       # æ–‡ä»¶è·¯å¾„é…ç½®
â”‚   â””â”€â”€ common_utils.py                            # é€šç”¨å·¥å…·å‡½æ•°
â”‚
â”œâ”€â”€ æ•°æ®åº“åˆ›å»ºè„šæœ¬
â”‚   â”œâ”€â”€ create_elasticsearch_index.py              # åˆ›å»ºElasticsearchç´¢å¼•
â”‚   â””â”€â”€ create_vector_database.py                  # åˆ›å»ºMilvuså‘é‡æ•°æ®åº“
â”‚
â”œâ”€â”€ æ­¥éª¤1: PDFå¤„ç†
â”‚   â””â”€â”€ step1_process_pdfs.py                      # PDFæ–‡æ¡£é¢„å¤„ç†,åŒºåˆ†çŸ¢é‡é¡µå’Œæ‰«æé¡µ
â”‚
â”œâ”€â”€ æ­¥éª¤2: æ–‡æœ¬æå–
â”‚   â””â”€â”€ step2_extract_text_onlyvactor_multi_process.py  # çŸ¢é‡é¡µæ–‡æœ¬æå–(å¤šè¿›ç¨‹)
â”‚
â”œâ”€â”€ æ­¥éª¤3: è¡¨æ ¼æ£€æµ‹ä¸è·¨é¡µåˆå¹¶
â”‚   â”œâ”€â”€ step3_cross_page_table_detector.py         # è·¨é¡µè¡¨æ ¼æ£€æµ‹å™¨(åŸºç¡€ç‰ˆ)
â”‚   â”œâ”€â”€ step3_1_detection_vactor_multi_process.py  # çŸ¢é‡é¡µè¡¨æ ¼æ£€æµ‹(å¤šè¿›ç¨‹)
â”‚   â””â”€â”€ step3_2_table_detection_scan_multifile.py  # æ‰«æé¡µè¡¨æ ¼æ£€æµ‹(å¤šæ–‡ä»¶å¤„ç†)
â”‚
â”œâ”€â”€ æ­¥éª¤4: å›¾åƒæè¿°ç”Ÿæˆ
â”‚   â”œâ”€â”€ step4_compress_image.py                    # å›¾åƒå‹ç¼©å·¥å…·
â”‚   â”œâ”€â”€ step4_1_1_describe_table_images_multi_thread.py      # è¡¨æ ¼å›¾åƒæè¿°ç”Ÿæˆ(ç¬¬ä¸€è½®,å¤šçº¿ç¨‹)
â”‚   â”œâ”€â”€ step4_1_2_describe_table_images_multi_thread_second.py  # è¡¨æ ¼å›¾åƒæè¿°ç”Ÿæˆ(ç¬¬äºŒè½®,å¤šçº¿ç¨‹)
â”‚   â”œâ”€â”€ step4_2_1_describe_not_table_images_llm.py # éè¡¨æ ¼å›¾åƒæè¿°ç”Ÿæˆ(LLM)
â”‚   â”œâ”€â”€ step4_2_2_describe_not_table_images_llm_second.py  # éè¡¨æ ¼å›¾åƒæè¿°ç”Ÿæˆ(ç¬¬äºŒè½®)
â”‚   â”œâ”€â”€ step4_describe_not_table_images_PaddleOCR.py  # éè¡¨æ ¼å›¾åƒOCRè¯†åˆ«(PaddleOCR)
â”‚   â”œâ”€â”€ step4_table_utils.py                       # è¡¨æ ¼å¤„ç†å·¥å…·(å•çº¿ç¨‹)
â”‚   â”œâ”€â”€ step4_table_utils_ali.py                   # è¡¨æ ¼å¤„ç†å·¥å…·(é˜¿é‡Œäº‘API)
â”‚   â”œâ”€â”€ step4_table_utils_ali_multi_thread.py      # è¡¨æ ¼å¤„ç†å·¥å…·(é˜¿é‡Œäº‘API,å¤šçº¿ç¨‹)
â”‚   â””â”€â”€ step4_table_utils_multi_thresd.py          # è¡¨æ ¼å¤„ç†å·¥å…·(å¤šçº¿ç¨‹)
â”‚
â”œâ”€â”€ æ­¥éª¤5: æ–‡æœ¬åˆå¹¶
â”‚   â””â”€â”€ step5_merge_table_into_text.py             # åˆå¹¶è¡¨æ ¼æè¿°åˆ°æ­£æ–‡
â”‚
â”œâ”€â”€ æ­¥éª¤6: æ–‡æœ¬åˆ†å‰²
â”‚   â””â”€â”€ step6_text_segmentation.py                 # æ™ºèƒ½æ–‡æœ¬åˆ‡åˆ†(ä¿æŠ¤è¡¨æ ¼å®Œæ•´æ€§)
â”‚
â”œâ”€â”€ æ­¥éª¤7: æ–‡æœ¬å‘é‡åŒ–
â”‚   â””â”€â”€ step7_text_embedding.py                    # ç”Ÿæˆæ–‡æœ¬åµŒå…¥å‘é‡
â”‚
â””â”€â”€ æ­¥éª¤8: æ•°æ®å­˜å‚¨
    â”œâ”€â”€ step8_1_ingest_elasticsearch_data.py       # å¯¼å…¥æ•°æ®åˆ°Elasticsearch
    â””â”€â”€ step8_2_ingest_vector_database.py          # å¯¼å…¥æ•°æ®åˆ°Milvuså‘é‡åº“
```

## âš™ï¸ å®‰è£…ä¸é…ç½®

### 1. ç¯å¢ƒè¦æ±‚

- Python 3.8+
- MySQL 5.7+
- Elasticsearch 7.x+
- Milvus 2.x+
- è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´ç”¨äºå­˜å‚¨PDFæ–‡ä»¶å’Œç”Ÿæˆçš„æ•°æ®

### 2. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### 3. é…ç½®æ•°æ®åº“

ç¼–è¾‘ `db_config.py` æ–‡ä»¶,é…ç½®æ‚¨çš„æ•°æ®åº“è¿æ¥ä¿¡æ¯:
- MySQLæ•°æ®åº“å¯†ç 
- Elasticsearchå¯†ç 
- Milvuså‘é‡æ•°æ®åº“å¯†ç 

### 4. é…ç½®APIå¯†é’¥

ç¼–è¾‘ `model_config.py` æ–‡ä»¶,é…ç½®æ‚¨çš„AIæ¨¡å‹APIå¯†é’¥:
- DeepSeek APIå¯†é’¥
- æ™ºè°±AI APIå¯†é’¥
- é˜¿é‡Œäº‘é€šä¹‰åƒé—®APIå¯†é’¥


### 5. é…ç½®æ–‡ä»¶è·¯å¾„

ç¼–è¾‘ `file_paths_config.py` æ–‡ä»¶,è®¾ç½®PDFè¾“å…¥è·¯å¾„å’Œè¾“å‡ºè·¯å¾„ã€‚

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å®Œæ•´æµç¨‹è¿è¡Œ

æŒ‰é¡ºåºæ‰§è¡Œä»¥ä¸‹è„šæœ¬:

```bash
# æ­¥éª¤1: å¤„ç†PDF
python step1_process_pdfs.py

# æ­¥éª¤2: æå–æ–‡æœ¬
python step2_extract_text_onlyvactor_multi_process.py

# æ­¥éª¤3: æ£€æµ‹è¡¨æ ¼
python step3_1_detection_vactor_multi_process.py
python step3_2_table_detection_scan_multifile.py

# æ­¥éª¤4: ç”Ÿæˆå›¾åƒæè¿°
python step4_1_1_describe_table_images_multi_thread.py
python step4_1_2_describe_table_images_multi_thread_second.py
python step4_2_1_describe_not_table_images_llm.py
python step4_2_2_describe_not_table_images_llm_second.py

# æ­¥éª¤5: åˆå¹¶æ–‡æœ¬
python step5_merge_table_into_text.py

# æ­¥éª¤6: æ–‡æœ¬åˆ†å‰²
python step6_text_segmentation.py

# æ­¥éª¤7: ç”Ÿæˆå‘é‡
python step7_text_embedding.py

# æ­¥éª¤8: å­˜å‚¨æ•°æ®
python step8_1_ingest_elasticsearch_data.py
python step8_2_ingest_vector_database.py
```

## ğŸ“§ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®,è¯·è”ç³»: 412447958@qq.com

